<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta charset="utf-8">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" href="/stylesheets/screen.css" media="all">
        <link rel="stylesheet" href="/stylesheets/print.css" media="print">
        <script src="/js/vendor/modernizr.js"></script>
        <script src="https://cdn.socket.io/socket.io-1.0.6.js"></script>
        <!--[if lt IE 9]>
            <script src="/js/vendor/html5shiv.js"></script>
        <![endif]-->

    </head>
    <body class="gallery design-one">
    	{% include '_svgdefs.html' %}

        <img class="logo" src="/img/cmart.jpg">
        
        <div class="new-photos">
            <div></div>
            <button>load</button>
        </div>

        {% block content %}
			<p>not set up</p>
		{% endblock %}

        <div class="upload-photo">
            <button class="upload">
                <svg class="icon icon-camera active"><use xlink:href="#icon-camera"></use></svg>
                <svg class="icon icon-spinner"><use xlink:href="#icon-camera"></use></svg>
            </button>

            <form method="post" accept-charset="UTF-8" class="upload-photo-form">
                {{ getCsrfInput() }}
                <input type="hidden" name="action" value="guestEntries/saveEntry">
                <input type="hidden" name="redirect" value="success">
                <input type="hidden" name="sectionId" value="3">

                <input type="file" name="fields[eventPhoto]" accept="image/*">

                <input type="submit" value="Publish">
            </form>
        </div>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/js/vendor/jquery.js"><\/script>')</script>
        <script src="/js/vendor/ajaxform.js"></script>
        <script src="/js/main.js"></script>
        <script>
        $(document).ready(function(){
             var socket = io('http://45.55.245.33', {
            //var socket = io('localhost:8000', {
                transports: ['websocket']
            });

            var newPhotosBox = $('.new-photos');
            var newPhotos = [];

            socket.on('photo', function (data) {
                //$('#photos').prepend('<li><img src="' + data + '"></li>');
                newPhotos.push(data);
            });

            setInterval(function(){
                if(newPhotos.length > 0){
                    if(newPhotos.length === 1){
                        newPhotosBox.find('div').html('<p>1 new photo</p>');
                    }
                    else{
                        newPhotosBox.find('div').html('<p>'+newPhotos.length+' new photos')
                    }
                    newPhotosBox.addClass('active');
                }
                else{
                    newPhotosBox.removeClass('active');
                }
            },500);

            newPhotosBox.on('click',function(){
                console.log(newPhotos);

                for(i=0;i<newPhotos.length;i++){
                    $('#photos').prepend('<li><img src="' + newPhotos[i] + '"></li>');
                }
                newPhotosBox.removeClass('active');

                newPhotos = [];
            });

        });
        </script>
    </body>
</html>
